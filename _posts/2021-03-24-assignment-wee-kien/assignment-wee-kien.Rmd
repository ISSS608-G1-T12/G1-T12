---
title: "Investing 101: A visual and predictive guide for the rookie investor - Wee Kien"
description: |
  Existing financial data websites such as Yahoo Finance do a good job in providing historical price data and technical indicators, but the beginner investor lacks the knowledge to properly utilise and benefit from these. In addition, we have also identified several gaps in such websites.
  
  For one, these websites do not provide tools to allow the user to compare stocks meaningfully or zoom in to the statistical properties of financial returns. For example, a user is unable to conduct correlation analysis or visualize the distribution of returns. Secondly, these websites also do not provide any form of forecasting to aid in investorsâ€™ decisions.
    
  This project aims to improve on the current offering of financial data websites through, Exploratory Data Analysis, Time-Series Forecasting and also Time-Series Clustering.
  
author:
  - name: Wee Kien, Ng (Vincent)
    url: https://www.linkedin.com/in/ngweekiensg/
date: 03-24-2021
output:
  distill::distill_article:
    self_contained: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## 1. Overview

### 1.1 Background

Traditional financial data websites usually shy away from giving recommendations or advising users on investing decisions. While in depth studies are often conducted and used in academia or research, the outputs of these studies are often not accessible nor timely enough for the regular user. This means that these websites and their applications are limited in their use-cases. This can be due to issues arising from financial or legal liability if users act on the recommendations coming from these financial websites. As such we feel that this a gap between what is available publicly and user requirements. 

### 1.2 Objective and Motivation

TO BE ADDED

To talk about what other modules will focus on.

What we are doing in this particular module.

- Charting and technical analysis
- Correlation analysis between selected portfolio of stocks vs a benchmark index
- Portfolio analysis:
  - Individual portfolio returns
  - Equity curve/ portfolio growth over time


### 1.3 Charting and Technical Analysis

In this module, users are able to visualize the chosen stock symbol using a candlestick chart. Open, High, Low, and Close prices for the selected period are shown on the chart.

In addition, users are able to choose between 2 sets of technical indicators: Simple moving averages and Bollinger Bands.

Users are able to see the chosen symbol on 1 chart, and the accompanying benchmark index chosen on another chart.

Both charts are created in an interactive manner using the plotly package.

Moving Averages:

- XXX
- XXX

Bollinger Bands:

- XXX
- XXX


### 1.4 Correlation Analysis

In this module, users are able to:

- Choose 4 stock symbols and visualize their monthly adjusted prices
- Visualize any anomalous points for these 4 stock symbols using an interactive chart
- Visualize the 6 month rolling correlation between the 4 stock symbols, and the accompanying benchmark index


### 1.5 Portfolio Analysis

In this module, users are able to:

- Create 3 portfolios with different weightages for the 4 chosen stock symbols plus the accompanying benchmark index
- Visualize the monthly returns (in %) for the 3 different portfolios on an interactive plot
- Visualize an equity curve of the 3 portfolios, where users are able to choose the starting equity amount


## 2. Proposed Visualization

### 2.1 Sketch of Proposed Visualization

TO INSERT SKETCH HERE, can be multiple pictures.
Can take from powerpoint slide.


### 2.2 Suggested Interactivity in the Proposed Visualization

TO DESCRIBE in words, the various portions of the interactivity.


## 3. Building the Visualization

### 3.1 Setting up the environment/ packages

First, we run this first line of code to clear the environment and remove existing R objects (if any)

```{r, echo=TRUE, eval=TRUE, fig.cap="Starting on a clean slate"}

rm(list=ls())

```

This code chunk checks if required packages are installed. If they are not installed, the next line of code will install them. The following line is then use to import the library into the current working environment.

```{r, echo=TRUE, eval=TRUE, fig.cap="Installing and importing libraries"}

packages = c('tidyverse','tidyquant','dygraphs','plotly','ggplot2','timetk')
for (p in packages) {
  if(!require(p,character.only = T)){
    install.packages(p)
  }
  library(p,character.only = T)
}

```

### 3.2 Charting and Technical Analysis

Users will be able to specify the start and end dates for the period under analysis. In addition, they are able to specify the periodicity (e.g. days, weeks, months, years).

```{r, echo=TRUE, eval=TRUE, fig.cap="Setting the start and end dates of the period under analysis"}
from_date <- "2016-01-01"
to_date <- "2018-12-31"
period_type <- "days"
# "days"/ "weeks"/ "months"/ "years"
```

Users are able to select the individual stock symbol and benchmark index of their choice. The following code chunk utilizes the tidyquant package to extract stock data from Yahoo Finance. Depending on the period_type specified by users before, the periodicity can be changed.

```{r, echo=TRUE, eval=TRUE, fig.cap="Extracting stock data based on user input symbols"}
ticker_selected <- "AAPL" 

ticker_data_daily <- tq_get(ticker_selected,
               get = "stock.prices",
               from = from_date,
               to = to_date) %>%
            tq_transmute(select     = NULL, 
                 mutate_fun = to.period, 
                 period     = period_type)
ticker_data_daily 

# Benchmark Index
benchmark_selected <- "XLK"

benchmark_data_daily <- tq_get(benchmark_selected,
               get = "stock.prices",
               from = from_date,
               to = to_date) %>%
              tq_transmute(select     = NULL, 
                 mutate_fun = to.period, 
                 period     = period_type)
benchmark_data_daily
```

The following code chunk creates a clean candlestick chart without indicators for the selected stock ticker and benchmark index. To use the dygraphs package, the input data has to be transformed from tibble to xts (extensible time series) format. We use the tk_xts() function from the timetk package for this.

For charting, we use the dygraph package. We specify dyCandlestick() to create a candlestick chart, and dyRangeSelector() to allow users to have the ability to toggle the range on the charts. In addition, specifying the group = "charting" argument allows for synchronization between charts sharing the same argument value. Changes made to either affects both charts interactively.

```{r, echo=TRUE, eval=TRUE, out.width="100%", fig.cap="Normal graphs without indicators"}
ticker_data_daily_xts <- tk_xts(
  ticker_data_daily %>%  select(date, open,high,low,close) )

ticker_data_daily_xts %>%
  dygraph(main = "Candlestick Chart for AAPL", group = "charting") %>% 
    dyCandlestick() %>%
    dyRangeSelector() 

benchmark_data_daily_xts <- tk_xts(
  benchmark_data_daily %>%  select(date, open,high,low,close) )

benchmark_data_daily_xts %>%
  dygraph(main = "Candlestick Chart for Benchmark Index (XLK)", group = "charting") %>% 
    dyCandlestick() %>% 
    dyRangeSelector()
```

The following code chunk creates a similar candlestick chart, this time with the simple moving averages technical indicator.

```{r, echo=TRUE, eval=TRUE, out.width="100%", fig.cap="Candlestick graphs with simple moving average indicators"}
# 20-day SMA
sma_fast <- SMA(ticker_data_daily_xts$close, n=20)
# 40-day SMA
sma_med <- SMA(ticker_data_daily_xts$close, n=40)
# 200-day SMA
sma_slow <- SMA(ticker_data_daily_xts$close, n=200)

ticker_data_daily_xts_sma <- data.frame(ticker_data_daily_xts, sma_fast, sma_med, sma_slow)

# head(ticker_data_daily_xts_sma)

chart_sma <- cbind(ticker_data_daily_xts_sma[,1:4], ticker_data_daily_xts_sma[,5], ticker_data_daily_xts_sma[,6], ticker_data_daily_xts_sma[,7])
colnames(chart_sma)[5]  <- "Fast SMA"
colnames(chart_sma)[6]  <- "Medium SMA"
colnames(chart_sma)[7]  <- "Slow SMA"

chart_sma %>%
  dygraph(main = "Candlestick Chart for AAPL - Simple Moving Averages", group = "chart_sma") %>% 
    dyCandlestick() %>% 
    dyRangeSelector()

# 20-day SMA
sma_fast_bm <- SMA(benchmark_data_daily_xts$close, n=20)
# 40-day SMA
sma_med_bm <- SMA(benchmark_data_daily_xts$close, n=40)
# 200-day SMA
sma_slow_bm <- SMA(benchmark_data_daily_xts$close, n=200)

benchmark_data_daily_xts_sma <- data.frame(benchmark_data_daily_xts, sma_fast_bm, sma_med_bm, sma_slow_bm)

# head(benchmark_data_daily_xts_sma)

chart_sma_bm <- cbind(benchmark_data_daily_xts_sma[,1:4], benchmark_data_daily_xts_sma[,5], benchmark_data_daily_xts_sma[,6], benchmark_data_daily_xts_sma[,7])
colnames(chart_sma_bm)[5]  <- "Fast SMA"
colnames(chart_sma_bm)[6]  <- "Medium SMA"
colnames(chart_sma_bm)[7]  <- "Slow SMA"

chart_sma_bm %>%
  dygraph(main = "Candlestick Chart for Benchmark (XLK) - Simple Moving Averages", group = "chart_sma") %>% 
    dyCandlestick() %>% 
    dyRangeSelector()
```

The following code chunk creates a similar candlestick chart, this time with the Bollinger Bands technical indicator.

```{r, echo=TRUE, eval=TRUE, out.width="100%", fig.cap="Candlestick graphs with bollinger bands indicators"}
bb20 <- BBands(ticker_data_daily_xts$close, sd=2.0, n=14, maType=EMA)

ticker_data_daily_xts_bb <- data.frame(ticker_data_daily_xts, bb20)

chart_bband <- cbind(ticker_data_daily_xts_bb[,1:4], ticker_data_daily_xts_bb[,5], ticker_data_daily_xts_bb[,6], ticker_data_daily_xts_bb[,7])
colnames(chart_bband)[5]  <- "Lower Band"
colnames(chart_bband)[6]  <- "Moving Average"
colnames(chart_bband)[7]  <- "Upper Band"

chart_bband %>%
  dygraph(main = "Candlestick Chart for AAPL - Bollinger Bands", group = "chart_bband") %>% 
    dyCandlestick() %>% 
    dyRangeSelector()


bb20_bm <- BBands(benchmark_data_daily_xts$close, sd=2.0, n=14, maType=EMA)

benchmark_data_daily_xts_bb <- data.frame(benchmark_data_daily_xts, bb20_bm)

chart_bband_bm <- cbind(benchmark_data_daily_xts_bb[,1:4], benchmark_data_daily_xts_bb[,5], benchmark_data_daily_xts_bb[,6], benchmark_data_daily_xts_bb[,7])
colnames(chart_bband_bm)[5]  <- "Lower Band"
colnames(chart_bband_bm)[6]  <- "Moving Average"
colnames(chart_bband_bm)[7]  <- "Upper Band"

chart_bband_bm %>%
  dygraph(main = "Candlestick Chart for Benchmark (XLK) - Bollinger Bands", group = "chart_bband") %>% 
    dyCandlestick() %>% 
    dyRangeSelector()

```

### 3.3 Correlation Analysis



### 3.4 Portfolio Analysis







## 4. Conclusions and Insights


## 5. References

















